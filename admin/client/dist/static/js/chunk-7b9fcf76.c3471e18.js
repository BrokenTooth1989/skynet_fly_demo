(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b9fcf76"],{"457b":function(e,t,r){},"5a93":function(e,t,r){"use strict";r("457b")},9406:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard-container"},[t(e.curcomponent,{tag:"component"})],1)},n=[],a=r("5530"),s=r("2f62"),o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard-monitor-container"},[t("panel-group",{on:{handleSetLineChartData:e.handleSetLineChartData,handleNotData:e.handleNotData}}),t("el-row",{staticStyle:{background:"#fff",padding:"16px 16px 0","margin-bottom":"32px"}},[t("line-chart",{attrs:{"chart-data":e.lineChartData,"is-notdata":e.isNotData}})],1),t("el-row",{directives:[{name:"show",rawName:"v-show",value:e.isCurDay,expression:"isCurDay"}]},[t("server-info",{attrs:{cluster:e.cluster,server:e.server}})],1)],1)},l=[],c=function(){var e=this,t=e._self._c;return t("div",[t("el-select",{attrs:{placeholder:"请选择哪天"},model:{value:e.pre_day,callback:function(t){e.pre_day=t},expression:"pre_day"}},e._l(e.dayOption,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("el-select",{attrs:{placeholder:"请选择集群服务节点"},model:{value:e.cluster,callback:function(t){e.cluster=t},expression:"cluster"}},e._l(e.clusterList,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:e}})})),1),t("el-select",{attrs:{placeholder:"请选择服务"},model:{value:e.server,callback:function(t){e.server=t},expression:"server"}},e._l(e.serverList,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:e}})})),1)],1)},u=[],d=r("c7eb"),h=r("1da1"),f=r("b775");function v(){return Object(f["a"])({url:"/monitor/cluster_list",method:"get"})}function m(e,t,r){return Object(f["a"])({url:"/monitor/info",method:"get",params:{server_name:t,cluster_name:e,pre_day:r}})}function p(e,t){return Object(f["a"])({url:"/monitor/serverinfo",method:"get",params:{cluster_name:e,server_name:t}})}var _=[{value:0,label:"当天"},{value:1,label:"昨天"},{value:2,label:"前天"},{value:3,label:"前第三天"},{value:4,label:"前第四天"},{value:5,label:"前第五天"},{value:6,label:"前第六天"},{value:7,label:"前第七天"}],b={data:function(){return{pre_day:null,cluster:null,server:null,dayOption:_,clusterList:[],serverList:[],serverMap:{}}},created:function(){this.getClusterList()},watch:{cluster:{handler:function(e){this.serverList=this.serverMap[e],this.handleSetLine()}},server:{handler:function(e){this.handleSetLine()}},pre_day:{handler:function(e){this.handleSetLine()}}},methods:{getClusterList:function(){var e=this;return Object(h["a"])(Object(d["a"])().mark((function t(){var r;return Object(d["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,v();case 2:r=t.sent,console.log("getClusterList>>>",r),e.clusterList=r.data.cluster_list,e.serverMap=r.data.server_map;case 6:case"end":return t.stop()}}),t)})))()},getInfo:function(){var e=this;return Object(h["a"])(Object(d["a"])().mark((function t(){var r,i,n,a,s,o,l,c,u,h;return Object(d["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,m(e.cluster,e.server,e.pre_day);case 2:if(r=t.sent,i=r.data,console.log("getInfo>> ",i),"OK"==i.result){t.next=8;break}return e.$emit("handleNotData"),t.abrupt("return");case 8:for(i=i.data,n=[],a={},s=0;s<i.length;s++)for(l in o=i[s],o)for(u in n.push(l),c=i[s][l],c)h=c[u],a[u]||(a[u]=[]),a[u].push(h);console.log("opts:",a),e.$emit("handleSetLineChartData",{time:n,opts:a},e.cluster,e.server,e.pre_day);case 14:case"end":return t.stop()}}),t)})))()},handleSetLine:function(){this.cluster&&this.server&&this.getInfo()}}},F=b,D=r("0c7c"),g=Object(D["a"])(F,c,u,!1,null,null,null),y=g.exports,w=function(){var e=this,t=e._self._c;return e.isNotdata?t("div",{style:{height:e.height,width:e.width}},[e._v("暂无数据")]):t("div",{class:e.className,style:{height:e.height,width:e.width}})},E=[],C=r("313e"),L=r.n(C),x=r("ed08"),S={data:function(){return{$_sidebarElm:null,$_resizeHandler:null}},mounted:function(){var e=this;this.$_resizeHandler=Object(x["a"])((function(){e.chart&&e.chart.resize()}),100),this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},beforeDestroy:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},activated:function(){this.$_initResizeEvent(),this.$_initSidebarResizeEvent()},deactivated:function(){this.$_destroyResizeEvent(),this.$_destroySidebarResizeEvent()},methods:{$_initResizeEvent:function(){window.addEventListener("resize",this.$_resizeHandler)},$_destroyResizeEvent:function(){window.removeEventListener("resize",this.$_resizeHandler)},$_sidebarResizeHandler:function(e){"width"===e.propertyName&&this.$_resizeHandler()},$_initSidebarResizeEvent:function(){this.$_sidebarElm=document.getElementsByClassName("sidebar-container")[0],this.$_sidebarElm&&this.$_sidebarElm.addEventListener("transitionend",this.$_sidebarResizeHandler)},$_destroySidebarResizeEvent:function(){this.$_sidebarElm&&this.$_sidebarElm.removeEventListener("transitionend",this.$_sidebarResizeHandler)}}};r("817d");var B=["#70DB93","#5C3317","#9F5F9F","#B5A642","#8C7853","#A67D3D","#5F9F9F","#D98719","#B87333","#FF7F00","#42426F","#2F4F2F","#4A766E","#4F4F2F","#9932CD","#871F78","#6B238E","#2F4F4F","#97694F","#7093DB","#855E42","#545454","#856363","#238E23","#CD7F32","#527F76","#93DB70","#215E21","#4E2F2F","#C0D9D9","#9F9F5F","#A8A8A8","#8F8FBD","#E9C2A6","#32CD32","#E47833","#8E236B","#32CD99","#3232CD","#6B8E23","#EAEAAE","#9370DB","#426F42","#7F00FF","#7FFF00","#70DBDB","#DB7093","#A68064","#2F2F4F","#23238E","#4D4DFF","#FF6EC7","#EBC79E","#CFB53B","#FF7F00","#FF2400","#DB70DB","#8FBC8F","#BC8F8F","#EAADEA","#D9D9F3","#5959AB","#6F4242","#BC1717","#238E68","#6B4226","#8E6B23","#E6E8FA","#3299CC","#007FFF","#FF1CAE","#00FF7F","#236B8E","#38B0DE","#D8BFD8","#ADEAEA","#5C4033","#CDCDCD","#4F2F4F","#CC3299","#D8D8BF","#99CC32"],O={mixins:[S],props:{className:{type:String,default:"chart"},width:{type:String,default:"100%"},height:{type:String,default:"450px"},autoResize:{type:Boolean,default:!0},chartData:{type:Object,required:!0},isNotdata:{tpye:Boolean,default:!0}},data:function(){return{chart:null}},watch:{chartData:{deep:!0,handler:function(e){console.log("handler>>>",e),this.setOptions(e)}},isNotdata:{handler:function(e){if(console.log("isNotdata:",this.isNotdata,e),this.isNotdata){if(!this.chart)return;this.chart.dispose(),this.chart=null}}}},mounted:function(){},beforeDestroy:function(){this.chart&&(this.chart.dispose(),this.chart=null)},methods:{resetChart:function(){this.chart?(this.chart.dispose(),this.chart=null,this.chart=L.a.init(this.$el,"macarons")):this.chart=L.a.init(this.$el,"macarons")},setOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.time,r=e.opts;if(t&&!(t.length<=0)){this.resetChart(),console.log("ddd",r,this.isNotdata);var i={xAxis:{data:t,boundaryGap:!1,axisTick:{show:!1}},grid:{left:10,right:10,bottom:20,top:30,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"cross"},padding:[5,10]},yAxis:{axisTick:{show:!1}},legend:{data:[]},series:[]},n=0;for(var a in r){var s=r[a],o=B[n];i.legend.data.push(a),i.series.push({name:a,smooth:!0,type:"line",data:s,animationDuration:2800,animationEasing:"quadraticOut",itemStyle:{normal:{color:o,lineStyle:{color:o,width:2}}}}),n++,n%=B.length}this.chart.setOption(i)}}}},$=O,j=Object(D["a"])($,w,E,!1,null,null,null),k=j.exports,z=function(){var e=this,t=e._self._c;return t("div",[t("el-descriptions",{attrs:{title:"服务实时信息",column:4,border:""}},[t("el-descriptions-item",{attrs:{label:"运行时长"}},[e._v(e._s(e.serverRunTime))]),t("el-descriptions-item",{attrs:{label:"模块名称"}},[e._v(" "+e._s(e.moduleName))]),t("el-descriptions-item",{attrs:{label:"启动时间"}},[e._v(" "+e._s(e.launchTime))]),t("el-descriptions-item",{attrs:{label:"版本号"}},[e._v(" "+e._s(e.version))]),t("el-descriptions-item",{attrs:{label:"启动下标"}},[e._v(" "+e._s(e.index))]),t("el-descriptions-item",{attrs:{label:"服务状态"}},[e._v(" "+e._s(e.serverState))]),t("el-descriptions-item",{attrs:{label:"退出剩余时间"}},[e._v(" "+e._s(e.exitRemainTime))])],1),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:6}},[t("h3",{staticStyle:{"text-align":"center"}},[e._v("访问者列表")]),e.sourceList?t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.sourceList,height:"250",border:""}},[t("el-table-column",{staticStyle:{width:"50%"},attrs:{prop:"name",label:"服务名称",border:""}}),t("el-table-column",{staticStyle:{width:"50%"},attrs:{prop:"address",label:"服务地址",border:""}})],1):e._e()],1),t("el-col",{attrs:{span:4}},[t("h3",{staticStyle:{"text-align":"center"}},[e._v("弱访问者列表")]),e.weekVisitorList?t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.weekVisitorList,height:"250",border:""}},[t("el-table-column",{staticStyle:{width:"100%"},attrs:{prop:"name",label:"服务名称",border:""}})],1):e._e()],1),t("el-col",{attrs:{span:14}},[t("h3",{staticStyle:{"text-align":"center"}},[e._v("访问列表")]),e.needVisitorList?t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.needVisitorList,height:"250",border:""}},[t("el-table-column",{attrs:{prop:"name",label:"服务名称",width:"180"}}),t("el-table-column",{staticStyle:{width:"75%"},attrs:{prop:"idsList",label:"服务地址列表",border:""}})],1):e._e()],1)],1)],1)},A=[],N={props:{cluster:{type:String,default:""},server:{type:String,default:""}},data:function(){return{run_time:null,module_info:null,server_state:null,exit_remain_time:0,sourceList:[],weekVisitorList:[],needVisitorList:[]}},computed:{serverRunTime:function(){var e=Math.floor(this.run_time/86400),t=this.run_time%86400,r=Math.floor(t/3600);t%=3600;var i=Math.floor(t/60);return e+" 天 "+r+" 小时 "+i+" 分钟 "},moduleName:function(){return this.module_info?this.module_info.module_name:"普通skynet服务"},launchTime:function(){return this.module_info?this.module_info.launch_date:"没有记录"},version:function(){return this.module_info?this.module_info.version:"没有"},index:function(){return this.module_info?this.module_info.index:"没有"},serverState:function(){return this.server_state?this.server_state:"没有"},exitRemainTime:function(){return this.serverState?"exited"!=this.serverState?"还没退出":this.exit_remain_time:"不能退出"}},watch:{cluster:{handler:function(e){this.getServerInfo()}},server:{handler:function(e){this.getServerInfo()}}},methods:{getServerInfo:function(){var e=this;return Object(h["a"])(Object(d["a"])().mark((function t(){var r,i,n,a,s,o,l,c,u,h,f,v,m;return Object(d["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("serverInfo 1",e.cluster,e.server),""!=e.cluster&&""!=e.server){t.next=3;break}return t.abrupt("return");case 3:return console.log("serverInfo 2",e.cluster,e.server),t.next=6,p(e.cluster,e.server);case 6:if(r=t.sent,e.run_time=r.data.run_time,r.data.server_info&&r.data.server_info.hot_container){if(i=r.data.server_info.hot_container,e.module_info=i.module_info,e.server_state=i.server_state,e.exit_remain_time=i.exit_remain_time,n=i.source_map,e.sourceList=[],n)for(a in n)s=n[a],e.sourceList.push({address:a,name:s});if(e.weekVisitorList=[],o=i.week_visitor_map,o)for(l in o)e.weekVisitorList.push({name:l});if(e.needVisitorList=[],c=i.need_visitor_map,c)for(u in c){for(h=c[u],f="",v=0;v<h.length;v++){for(f+="[",m=0;m<h[v].length;m++)f+=h[v][m],m<h[v].length-1&&(f+=",");f+="]"}e.needVisitorList.push({name:u,idsList:f})}}else e.module_info=null,e.server_state=null,e.exit_remain_time=0,e.sourceList=[],e.weekVisitorList=[],e.needVisitorList=[];console.log("serverInfo 3",e.cluster,e.server,r);case 10:case"end":return t.stop()}}),t)})))()}}},R=N,V=Object(D["a"])(R,z,A,!1,null,null,null),I=V.exports,T={name:"DashboardMonitor",components:{PanelGroup:y,LineChart:k,ServerInfo:I},data:function(){return{lineChartData:{},cluster:null,server:null,isNotData:!0,isCurDay:!1}},methods:{handleSetLineChartData:function(e,t,r,i){console.log("handleSetLineChartData:",e,t,r),this.lineChartData=e,this.cluster=t,this.server=r,this.isNotData=!1,this.isCurDay=0==i},handleNotData:function(){console.log("没有数据>>>>>"),this.isNotData=!0}}},H=T,M=(r("5a93"),Object(D["a"])(H,o,l,!1,null,"20cf99ce",null)),q=M.exports,G={name:"Dashboard",components:{monitorDashBoard:q},data:function(){return{curcomponent:"monitorDashBoard"}},computed:Object(a["a"])({},Object(s["b"])([]))},J=G,P=Object(D["a"])(J,i,n,!1,null,null,null);t["default"]=P.exports},ed08:function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return a}));var i=r("53ca");r("a630"),r("a15b"),r("d81d"),r("fb6a"),r("b64b"),r("d3b7"),r("4d63"),r("ac1f"),r("2c3e"),r("00b4"),r("25f0"),r("6062"),r("3ca3"),r("466d"),r("4d90"),r("5319"),r("159b"),r("ddb0");function n(e,t,r){var i,n,a,s,o,l=function l(){var c=+new Date-s;c<t&&c>0?i=setTimeout(l,t-c):(i=null,r||(o=e.apply(a,n),i||(a=n=null)))};return function(){for(var n=arguments.length,c=new Array(n),u=0;u<n;u++)c[u]=arguments[u];a=this,s=+new Date;var d=r&&!i;return i||(i=setTimeout(l,t)),d&&(o=e.apply(a,c),a=c=null),o}}function a(e){if(!e&&"object"!==Object(i["a"])(e))throw new Error("error arguments","deepClone");var t=e.constructor===Array?[]:{};return Object.keys(e).forEach((function(r){e[r]&&"object"===Object(i["a"])(e[r])?t[r]=a(e[r]):t[r]=e[r]})),t}}}]);